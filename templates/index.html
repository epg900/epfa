<!doctype html>
<!-- locate in templates folder -->
<html lang="en">
  <head>
      <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="epfa file share">

    <link rel="stylesheet" href="/static/bootstrap.min.css">
      <title>epfs file share</title>
<style>
	tr {
	   white-space: nowrap;
	}
</style>
</head>
<body>
<!-- <div class="container-fluid">  -->
<table class="table table-striped table-hover">
<tbody>
    <tr>
		<form id="upload_file2" name="upload_file2" action = "/uploadfiles" method = "POST" enctype = "multipart/form-data" >
        <td>
            <input class="form-control"  type="file" name="files" id="files" multiple />
        </td>
        <td>
            <input class="btn btn-success" type = "button"  onclick="ax();" value="Upload File" />
        </td>
		</form>
    </tr>

	<tr>
		<td  colspan=5>
		<img src="/static/qr.png" title="Generate QR Code..." width=32px height=32px class="mx-2" role='button' onclick="qr();"  />
		{% if delitem == 1 %}
		{% if path %}
		<img src="/static/downdir.png" title="Download Folder as Zipfile..."  width=32px height=32px class="mx-2" role='button' onclick="if (confirm('Do you want to downloade?')) { window.open('/download_dir/{{ path }}/{{ b }}','_self'); } ;"   />
		{% endif %}
        <img src="/static/addfolder.png" title="Download Folder as Zipfile..."  width=32px height=32px class="mx-2" role='button' onclick="mkdir();"  />
		{% endif %}
		<img src="/static/up3.png" width=32px height=32px class="mx-2" />
		{% for i in varlist %}
		<input id="ch1" class="form-check-input"  type='checkbox' onchange='viewItem(".{{ i }}",this.checked);' checked>
		<label  class="form-check-label" for="ch1">{{ i }}</label>
		{% endfor %}
		</td>
	</tr>

    <tr>
    <td colspan=3 >
    <div id="pbar0" name="pbar0"  class="progress" style="display:none;">
        <div id="pbar" name="pbar"  class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
    </div>
	</td>
    </tr>

    {% if path %}
    <tr>
    <td colspan=4>
    <img src="/static/up3.png" width=32px height=32px class="mx-2" role='button'   />
    <img src="/static/up3.png" width=32px height=32px class="mx-2" role='button'   />
    <img src="/static/up.png" width=32px height=32px class="mx-2" role='button' onclick="window.open('/{{ path }}/..','_self');" />
	<a href="{{ request['website'] }}/{{ path }}/.." > .. </a>
    </td>
	</tr>
	{% endif %}
	{% for a in all_list %}
	{% set ploop = loop %}
	{% for b in a %}
    <tr class="{{ varlist[ploop.index - 1] }}" >
		<td colspan=4 >
		{% if delitem == 1 %}
		{% if path %}
		<img src="/static/del.png" title="Delete..."  width=32px height=32px class="mx-2" role='button' onclick="if (confirm('Do you really want delete?')) { window.open('/del/{{ path }}/{{ b }}','_self'); } ;"  />
		{% else %}
		<img src="/static/del.png" title="Delete..."  width=32px height=32px class="mx-2" role='button' onclick="if (confirm('Do you really want delete?')) { window.open('/del/{{ b }}','_self'); } ;"  />
		{% endif %}
		{% if path %}
		<img src="/static/nosh.png" title="Show/Hide..."  width=32px height=32px {% if b.0=='.' %} style='filter: grayscale(100%);' {% endif %} class="mx-2" role='button' onclick="if (confirm('Are you sure?')) { window.open('/nosh/{{ path }}/{{ b }}','_self'); } ;"  />
		{% else %}
		<img src="/static/nosh.png" title="Show/Hide..."  width=32px height=32px {% if b.0=='.' %} style='filter: grayscale(100%);' {% endif %} class="mx-2" role='button' onclick="if (confirm('Are you sure?')) { window.open('/nosh/{{ b }}','_self'); } ;"  />
		{% endif %}
		{% endif %}
		<img src="/static/{{ varlist[ploop.index - 1] }}.png" width=32px height=32px class="mx-2"  />
		{% if path %}
		<a href="{{ request['website'] }}/{{ path }}/{{ b }}" >
		{% else %}
		<a href="{{ request['website'] }}/{{ b }}" >
		{% endif %}
		{{ b }}
		</a>
        </td>
    </tr>
    {% endfor %}
	{% endfor %}
  </tbody>
</table>

<script src="/static/bootstrap.bundle.min.js" ></script>
<script  type="text/javascript" >

async function ax(){
    //e.preventDefault();
    var file = document.getElementById("files");
    let request = new XMLHttpRequest();
	post_path="/uploadfiles";
	path="/uploadfiles";
	{% if path %}
		path+="/";
		path+="{{ path }}";
	{% endif %}
    request.open("post",path, true);
    //request.setRequestHeader("Content-Type", "multipart/form-data");
    var fd = new FormData();
	var files = file.files;
	for (var i = 0; i < files.length; i++) {
	fd.append("file", file.files[i]);
	}


    request.upload.addEventListener('progress', event => {
    	let percent_complete = (event.loaded / event.total)*100;
    	console.log(percent_complete);
    	var pbar0 = document.getElementById("pbar0");
    	var pbar = document.getElementById("pbar");
    	pbar0.style = "display: block;"
    	pbar.style.width = String(Math.round(percent_complete)) + "%";
    	pbar.innerHTML = String(Math.round(percent_complete)) + "%";
    });

    request.addEventListener('load', function(e) {
	    window.location.reload();
    });
    request.send(fd);
}


async function fileupload(){
    var file = document.getElementById("files");
	var fd = new FormData();
	var files = file.files;
	for (var i = 0; i < files.length; i++) {
	fd.append("file", file.files[i]);
	}
    let response = await fetch('/uploadfiles/', {
        method: 'POST',
        body: fd
        //headers: {"Content-Type": "multipart/form-data"}
    }).then(response => {
		window.location.reload();
	})
    await console.log(response);
	}

function viewItem(res,val) {
const list = document.querySelectorAll(res);
for (const item of list) {
  item.hidden = !val
 }
}

function qr() {
  let newf = prompt("Please enter your text", "default");
  if (newf != null) {
	window.open('/qr/' + newf,'_self');
  }
}

function mkdir() {
  let newf = prompt("Please enter folder name", "NewFolder");
  if (newf != null) {
	{% if path %}
    window.open('/mkdir/{{path}}/' + newf,'_self');
	{% else %}
	window.open('/mkdir/' + newf,'_self');
	{% endif %}
  }
}


</script>
<!--</div>-->
</body>
</html>
